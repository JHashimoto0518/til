---
bibliography: 
repositoryUrl:
draft: true
---

# キャッシュを実装するには

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Reflection;
using PropsEnumSample.Attributes;

namespace PropsEnumSample.Enums {
    static class SubscriptionPlanUsingCacheExtensions {
        private static readonly Dictionary<(Type attributeType, SubscriptionPlanUsingCache plan), bool> cache = new();

        public static bool IsBillingPromotionFeatureEnabled(this SubscriptionPlanUsingCache self) {
            return IsTrue<BillingPromotionFeatureEnabledAttribute>(self);
        }

        // 他のメソッドも同様に実装

        private static bool IsTrue<T>(SubscriptionPlanUsingCache self) where T : EnumBooleanAttributeBase {
            var key = (attributeType: typeof(T), plan: self);
            if (!cache.TryGetValue(key, out bool value))
            {
                value = GetAttributeValue<T>(self);
                cache[key] = value;
            }
            return value;
        }

        private static bool GetAttributeValue<T>(SubscriptionPlanUsingCache self) where T : EnumBooleanAttributeBase {
            var planName = Enum.GetName(typeof(SubscriptionPlanUsingCache), self)!;
            var plan = self.GetType().GetField(planName)!;

            T attr = plan.GetCustomAttributes(typeof(T), inherit: false).Cast<T>().FirstOrDefault() ??
                throw new InvalidOperationException($"Attribute {typeof(T).Name} is not defined for {planName}.");

            return attr.Value;
        }
    }
}
```
